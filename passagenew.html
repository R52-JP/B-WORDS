<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>ã€å¤å…¸ã€‘åŸºæœ¬å˜èªãƒ†ã‚¹ãƒˆï¼ˆğ‘ç‰ˆï¼‰</title>
  <style>
    @font-face {
      font-family: 'MPlus1-Ebold'; 
      src: url('https://r52-jp.github.io/WORDS/Fonts/MPLUS1-ExtraBold.ttf') format('truetype');
    }
    @font-face {
      font-family: 'MPlus1-Regular'; 
      src: url('https://r52-jp.github.io/WORDS/Fonts/MPLUS1-Regular.ttf') format('truetype');
    }
    @font-face {
      font-family: 'ZenOldMincho-Medium'; 
      src: url('https://r52-jp.github.io/WORDS/Fonts/ZenOldMincho-Medium.ttf') format('truetype');
    }
    h1 {
        font-weight: normal;
        border-bottom: double 5px #FFC778;
        line-height: 1.5;
        font-family: "ZenOldMincho-Medium";
    }
    p {
      font-family: "ZenOldMincho-Medium";
      text-align: center;
      font-size:50px;
    }
    a {
      font-family: 'ZenOldMincho-Medium'; 
      text-align: center;
      font-size:20px;
      line-height: 50px;
    }
    button {
      font-family:'MPlus1-Regular'; 
      font-size: medium;
    }
    .count {
      font-family:'MPlus1-Regular'; 
    }
    .kanji {
      color: blue;
      font-family:'MPlus1-Regular'; 
      border-bottom: solid 1px red;
    }
    .mean {
      color: blue;
      font-family:'MPlus1-Regular'; 
      border-bottom: solid 1px red;
    }
    .range {
      font-family:'MPlus1-Regular'; 
      width: 50px;
    }
  </style>
</head>
<body>
  <h1 onclick="change_color()">ã€å¤å…¸ã€‘åŸºæœ¬å˜èªå°ãƒ†ã‚¹ãƒˆï¼ˆğ‘ç‰ˆï¼‰</h1>
  <input class="range" id="start"><a class="range">ç•ªã‹ã‚‰</a><input class="range" id="end"><a class="range">ç•ªã¾ã§è¡¨ç¤ºã€€</a><button id="rebuild">æ›´æ–°</button>ã€€<label><input type="checkbox" id="checkbox">é–¢é€£èªã‚’è¡¨ç¤º/éè¡¨ç¤º</label>
  <div id="main"></div>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  <script language="javascript" type="text/javascript">
    let data;
    const url = "https://r52-jp.github.io/B-WORDS/data-new.txt";
    const sub_num = ["â‘´","â‘µ","â‘¶","â‘·","â‘¸","â‘¹","â‘º","â‘»","â‘¼","â‘½","â‘¾"]
    const number_list = ["â‘ ", "â‘¡", "â‘¢", "â‘£", "â‘¤","â‘¥","â‘¦","â‘§","â‘¨","â‘©"]
    let now_color = "blue"
    $.get(url, (data_) => {
      data = data_ // (A)ã«å€¤ã‚’ä»£å…¥.
      // æ”¹è¡Œã‚³ãƒ¼ãƒ‰ã§data(æ–‡å­—åˆ—)ã‚’åˆ†å‰²â†’data(ãƒªã‚¹ãƒˆ).
      data = data.split("\n");
      // dataã®è¦ç´ ã®ã†ã¡ï¼Œå€¤ãŒã€Œ""ã€ã§ã‚ã‚‹ã‚‚ã®ã‚’å‰Šé™¤.
      for (let i=0; i<data.length; i++) {
        if (data[i] == "") {
          data.splice(i, 1);
        };
      };
      // ":"ã§dataã®å„è¦ç´ ã‚’åˆ†å‰².
      for (let i=0; i<data.length; i++) {
        data[i] = data[i].split(":");
      };
      // "/"ã§å˜èªã®æ„å‘³ã”ã¨ã«data[i][3]ã‚’åˆ†å‰².
      for (let i=0; i<data.length; i++) {
        data[i][3] = data[i][3].split("/");
      };
      generate(0, data.length-1, true);
    });


    function GetListIndex(WordIndex) {
      // å˜èªç•ªå·ã‹ã‚‰dataã§ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆï¼ï½ï¼‰ã‚’è¿”ã™.
      // æˆ»ã‚Šå€¤ã¯[é–‹å§‹ç•ªå·, çµ‚äº†ç•ªå·]. (é–¢é€£èªãªã©ã§ã¾ãŸãŒã‚‹å ´åˆãŒã‚ã‚‹ã‹ã‚‰).
      let result_S;
      let result_E;
      let words_num = parseInt( data.slice(-1)[0][0].substr(0, 3) )
      for (let i=0; i<data.length; i++) {
        if (WordIndex == data[i][0]) {
          result_S = i;
          break;
        } 
      }
      if (WordIndex == words_num) {
        result_E = data.length - 1
      } else {
        for (let i=0; i<data.length; i++) {
          if (WordIndex + 1 == data[i][0]) {
            result_E = i - 1;
            break;
          } 
        }
      }
      return [result_S, result_E]
    };

    function generate(start, end, rela) {
      // startãŠã‚ˆã³endã¯ãƒªã‚¹ãƒˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ0ï½ï¼‰ã§æŒ‡å®š.
      // relaã¯é–¢é€£èªè¡¨ç¤ºã®æœ‰ç„¡.
      let inHTML = ""
      for (let i=start; i<end+1; i++) {
        if (data[i][0].includes("-") && rela == false) {continue}
        if (data[i][0].includes("-")) {
          inHTML = inHTML + `ã€€ <a class="count">${sub_num[ parseInt(data[i][0][2])-1 ]} </a><a>${data[i][1]}</a><a>ã€ˆ</a><a id="kanji" class="kanji">${data[i][2]}</a><a>ã€‰ï¼š</a>`
        } else {
          inHTML = inHTML + `<a class="count">${data[i][0]}. </a><a>${data[i][1]}</a><a>ã€ˆ</a><a id="kanji" class="kanji">${data[i][2]}</a><a>ã€‰ï¼š</a>`
        };
        for (let j=0; j<data[i][3].length; j++) {
            inHTML = inHTML + `<a>${number_list[j]}</a><a id="mean" class="mean">${data[i][3][j]}</a>`
            if (j != data[i][3].length-1) {
              inHTML = inHTML + `<a>ï¼Œ</a>`
            }
        };
        inHTML = inHTML + "<br>";
      };
      document.getElementById("main").innerHTML = inHTML;
    };

    function change_color() {
      if (now_color == "blue") {
        now_color = "white";
        let kanji_elements = document.getElementsByClassName("kanji")
        let mean_elements = document.getElementsByClassName("mean")
        for (let i = 0; i < kanji_elements.length; i++) {
          kanji_elements[i].style.color = "white";
        }
        for (let i = 0; i < mean_elements.length; i++) {
          mean_elements[i].style.color = "white";
        }
      } else {
        now_color = "blue";
        let kanji_elements = document.getElementsByClassName("kanji")
        let mean_elements = document.getElementsByClassName("mean")
        for (let i = 0; i < kanji_elements.length; i++) {
          kanji_elements[i].style.color = "blue";
        }
        for (let i = 0; i < mean_elements.length; i++) {
          mean_elements[i].style.color = "blue";
        }
      }
    };

    function onClick_rebuild() {
      let s = parseInt(document.getElementById("start").value)
      let e = parseInt(document.getElementById("end").value)
      let r = document.getElementById("checkbox").checked
      let words_num = parseInt( data.slice(-1)[0][0].substr(0, 3) )
      if (0<s<=e<=words_num) {
        generate(GetListIndex(s)[0], GetListIndex(e)[1], r)
      }
    }
    
    document.getElementById("rebuild").setAttribute("onclick", "onClick_rebuild()")

  </script>
</body>
</html>